# CoTask 项目进度管理系统改造方案

## 一、项目概述

### 1.1 改造目标
将原制造业质检系统改造为**双部门项目进度管理系统**，支持：
- 玻丝焊芯宠物机器人研发部门
- 喵汪兔宠物用品运营部门

### 1.2 核心特点
- 统一系统，部门视图切换
- 聚焦项目进度可视化
- 主项目 + 子任务分层管理
- 简洁高效的进度跟踪

---

## 二、功能定义

### 2.1 核心功能模块

#### 模块1：部门管理
**功能点：**
- 部门选择/切换（研发部 ⇄ 运营部）
- 部门信息展示（部门名称、项目数量、成员数量）
- 部门数据隔离（只显示当前部门的项目）

**页面：**
- 部门选择页（首次进入/切换部门）

---

#### 模块2：项目看板（主项目管理）
**功能点：**
- 项目卡片展示（网格或列表视图）
  - 项目名称
  - 项目状态（未开始、进行中、已完成、已暂停）
  - 整体进度百分比（如：65%）
  - 负责人
  - 截止日期
  - 状态标签（正常/延期/风险）

- 快速操作
  - 创建新项目
  - 进入项目详情
  - 项目状态快速切换

- 筛选与排序
  - 按状态筛选
  - 按时间排序
  - 搜索项目名称

**页面：**
- 项目看板页（部门主页）

---

#### 模块3：项目详情（子任务管理）
**功能点：**
- 项目基本信息
  - 项目名称、描述
  - 负责人、创建时间
  - 开始时间 → 预计完成时间
  - 整体进度条

- 子任务列表（分支进展）
  - 任务名称
  - 负责人
  - 优先级（高/中/低）
  - 任务状态（待开始、进行中、已完成）
  - 完成度百分比
  - 截止时间
  - 状态图标（✓ 完成 / ⏱ 进行中 / ⚠ 延期）

- 任务操作
  - 添加子任务
  - 编辑任务
  - 更新进度
  - 删除任务

- 进度时间线
  - 显示项目的关键进度节点
  - 任务完成记录
  - 里程碑标记

**页面：**
- 项目详情页

---

#### 模块4：任务详情与进度更新
**功能点：**
- 任务详细信息展示
  - 任务描述
  - 负责人、创建人
  - 时间信息
  - 当前状态和进度

- 进度更新
  - 更新进度百分比（滑动条）
  - 添加进度说明
  - 上传进度截图/附件（保留原图片上传功能）
  - 更改任务状态

- 进度历史记录
  - 时间线展示所有更新记录
  - 更新人、更新时间、更新内容
  - 附件查看

**页面：**
- 任务详情页
- 进度更新页

---

#### 模块5：数据统计与分析
**功能点：**
- 部门概览
  - 总项目数
  - 进行中项目数
  - 本月完成项目数
  - 延期项目数

- 项目统计图表
  - 项目状态分布（饼图）
  - 项目进度趋势（折线图）
  - 本周/本月完成任务数（柱状图）

- 数据导出
  - 导出项目列表（Excel）
  - 导出任务详情（Excel）
  - 导出进度报告（PDF）

**页面：**
- 统计分析页（管理后台）

---

#### 模块6：用户与权限管理
**功能点：**
- 用户登录/登出
- 成员管理
  - 添加成员
  - 分配部门
  - 设置角色（管理员/成员）

- 权限控制
  - 管理员：全部门数据查看、项目创建/删除、成员管理
  - 成员：查看本部门项目、更新自己负责的任务

**页面：**
- 登录页
- 成员管理页（管理员）

---

### 2.2 保留的原系统功能
✅ **图片上传** - 用于进度截图、设计稿、产品图片
✅ **搜索过滤** - 项目和任务的快速查找
✅ **Excel导出** - 数据报表导出
✅ **云存储** - 附件和图片的云端存储
✅ **时间选择器** - 设置项目和任务时间

### 2.3 删除的原系统功能
❌ 22道工序管理
❌ 设备编号扫码
❌ 质检结果记录
❌ 合格/不合格判定
❌ 康鼎阶段流程

---

## 三、数据库设计

### 3.1 数据表结构

#### 表1：departments（部门表）
```json
{
  "_id": "部门ID",
  "name": "部门名称",
  "description": "部门描述",
  "create_time": "创建时间"
}
```

**初始数据：**
1. 玻丝焊芯宠物机器人研发部门
2. 喵汪兔宠物用品运营部门

---

#### 表2：projects（项目表）
```json
{
  "_id": "项目ID",
  "department_id": "所属部门ID",
  "name": "项目名称",
  "description": "项目描述",
  "owner": "负责人",
  "status": "项目状态", // 0=未开始 1=进行中 2=已完成 3=已暂停
  "progress": 0-100, // 整体进度百分比
  "start_time": "开始时间",
  "end_time": "预计完成时间",
  "actual_end_time": "实际完成时间",
  "priority": "优先级", // 1=低 2=中 3=高
  "create_time": "创建时间",
  "update_time": "更新时间"
}
```

**索引：** department_id, status

---

#### 表3：tasks（任务表）
```json
{
  "_id": "任务ID",
  "project_id": "所属项目ID",
  "name": "任务名称",
  "description": "任务描述",
  "owner": "负责人",
  "status": "任务状态", // 0=待开始 1=进行中 2=已完成 3=延期
  "progress": 0-100, // 完成度百分比
  "priority": "优先级", // 1=低 2=中 3=高
  "start_time": "开始时间",
  "due_time": "截止时间",
  "complete_time": "实际完成时间",
  "create_time": "创建时间",
  "update_time": "更新时间"
}
```

**索引：** project_id, status

---

#### 表4：progress_records（进度记录表）
```json
{
  "_id": "记录ID",
  "target_type": "目标类型", // project=项目, task=任务
  "target_id": "目标ID",
  "progress": "更新后的进度",
  "content": "进度说明",
  "updater": "更新人",
  "images": ["图片fileID数组"],
  "create_time": "创建时间"
}
```

**索引：** target_id, create_time

---

#### 表5：users（用户表）
```json
{
  "_id": "用户ID",
  "username": "用户名",
  "password": "密码（加密）",
  "name": "姓名",
  "department_id": "所属部门ID",
  "role": "角色", // admin=管理员, member=成员
  "create_time": "创建时间"
}
```

---

#### 表6：image_index（图片索引表 - 保留改造）
```json
{
  "_id": "记录ID",
  "target_type": "关联类型", // project/task/progress
  "target_id": "关联ID",
  "fileID": "云存储文件ID",
  "create_time": "创建时间"
}
```

---

## 四、页面结构设计

### 4.1 页面导航结构
```
登录页 (login)
  ↓
部门选择页 (department-select)
  ↓
┌─────────────────────────────────┐
│  底部导航栏（Tab Bar）              │
├─────────────────────────────────┤
│  项目看板  │  统计分析  │  我的  │
│  (home)   │  (stats)  │ (mine) │
└─────────────────────────────────┘
  ↓
项目详情页 (project-detail)
  ↓
任务详情页 (task-detail)
  ↓
进度更新页 (progress-update)
```

### 4.2 页面列表
1. **登录页** (`/pages/login/index`)
2. **部门选择页** (`/pages/department/select`)
3. **项目看板页** (`/pages/home/index`) - Tab主页
4. **项目详情页** (`/pages/project/detail`)
5. **任务详情页** (`/pages/task/detail`)
6. **进度更新页** (`/pages/progress/update`)
7. **统计分析页** (`/pages/stats/index`) - Tab
8. **我的页面** (`/pages/mine/index`) - Tab
9. **成员管理页** (`/pages/admin/members`) - 管理员

---

## 五、开发计划

### 阶段一：基础架构改造（2-3天）
**任务清单：**
- [x] 了解现有项目结构
- [ ] 设计新的数据库表结构
- [ ] 创建数据库schema文件
- [ ] 删除旧的工序相关代码
- [ ] 重构pages.json配置
- [ ] 设计全局样式和主题色
- [ ] 搭建底部Tab导航

**产出物：**
- 6个数据表schema
- 新的页面路由配置
- 基础UI框架

---

### 阶段二：部门与项目管理（3-4天）
**任务清单：**
- [ ] 开发部门选择页面
- [ ] 开发项目看板页面
  - [ ] 项目卡片组件
  - [ ] 项目列表/网格视图
  - [ ] 筛选和搜索功能
- [ ] 开发项目详情页面
  - [ ] 项目信息展示
  - [ ] 子任务列表
  - [ ] 进度时间线
- [ ] 开发创建/编辑项目功能
- [ ] 云函数开发
  - [ ] create_project（创建项目）
  - [ ] get_projects（获取项目列表）
  - [ ] get_project_detail（项目详情）
  - [ ] update_project（更新项目）
  - [ ] delete_project（删除项目）

**产出物：**
- 部门切换功能
- 完整的项目管理模块
- 5个云函数

---

### 阶段三：任务与进度管理（3-4天）
**任务清单：**
- [ ] 开发任务详情页面
- [ ] 开发进度更新页面
  - [ ] 进度百分比选择器
  - [ ] 图片上传（复用原功能）
  - [ ] 进度说明输入
- [ ] 开发任务创建/编辑功能
- [ ] 开发进度历史记录展示
- [ ] 云函数开发
  - [ ] create_task（创建任务）
  - [ ] get_tasks（获取任务列表）
  - [ ] update_task（更新任务）
  - [ ] delete_task（删除任务）
  - [ ] add_progress_record（添加进度记录）
  - [ ] get_progress_history（获取进度历史）

**产出物：**
- 任务管理模块
- 进度更新模块
- 6个云函数

---

### 阶段四：统计分析与导出（2-3天）
**任务清单：**
- [ ] 开发统计分析页面
  - [ ] 数据概览卡片
  - [ ] 图表组件（可使用uCharts或echarts）
  - [ ] 项目进度趋势图
- [ ] 开发Excel导出功能（改造原功能）
  - [ ] 项目列表导出
  - [ ] 任务详情导出
- [ ] 云函数开发
  - [ ] get_department_stats（部门统计）
  - [ ] export_projects（导出项目）
  - [ ] export_tasks（导出任务）

**产出物：**
- 数据统计模块
- 导出功能
- 3个云函数

---

### 阶段五：用户权限管理（2天）
**任务清单：**
- [ ] 开发登录页面
- [ ] 开发我的页面
  - [ ] 用户信息展示
  - [ ] 部门切换入口
  - [ ] 退出登录
- [ ] 开发成员管理页面（管理员）
- [ ] 实现权限控制逻辑
- [ ] 云函数开发
  - [ ] user_login（用户登录）
  - [ ] get_user_info（获取用户信息）
  - [ ] manage_users（用户管理）

**产出物：**
- 登录认证模块
- 权限管理系统
- 3个云函数

---

### 阶段六：测试与优化（2-3天）
**任务清单：**
- [ ] 功能测试
  - [ ] 部门切换流程
  - [ ] 项目CRUD操作
  - [ ] 任务CRUD操作
  - [ ] 进度更新流程
  - [ ] 数据统计准确性
- [ ] UI/UX优化
  - [ ] 响应式适配
  - [ ] 加载状态优化
  - [ ] 错误提示完善
- [ ] 性能优化
  - [ ] 数据库查询优化
  - [ ] 图片加载优化
  - [ ] 列表分页加载
- [ ] 初始数据准备
  - [ ] 创建初始部门
  - [ ] 创建测试账号
  - [ ] 添加示例项目

**产出物：**
- 稳定可用的系统
- 测试报告
- 用户使用文档

---

## 六、技术要点

### 6.1 前端技术
- **状态管理**: 使用Vuex管理当前部门、用户信息等全局状态
- **组件复用**: 项目卡片、任务卡片、进度条等封装为公共组件
- **数据缓存**: 使用uni.setStorageSync缓存部门选择、登录状态
- **图表库**: uCharts（uni-app适配）或引入echarts

### 6.2 后端技术
- **数据库索引**: 为高频查询字段添加索引
- **权限验证**: 云函数中验证用户身份和部门权限
- **数据聚合**: 使用aggregate进行复杂统计查询
- **文件管理**: 复用原云存储机制，优化文件命名规则

### 6.3 UI/UX设计
- **主题色方案**:
  - 研发部门: 科技蓝 (#1890FF)
  - 运营部门: 活力橙 (#FF6B35)
- **状态色**:
  - 进行中: 蓝色
  - 已完成: 绿色
  - 延期: 红色
  - 未开始: 灰色
- **进度可视化**:
  - 进度条（0-100%）
  - 环形进度图（项目概览）
  - 状态徽章

---

## 七、开发优先级

### P0（核心功能 - 必须实现）
1. 部门切换
2. 项目看板（创建、查看、编辑）
3. 任务管理（创建、查看、更新进度）
4. 用户登录

### P1（重要功能 - 第二优先级）
1. 项目详情与子任务展示
2. 进度历史记录
3. 基础统计数据
4. 搜索过滤

### P2（增强功能 - 可延后）
1. 高级图表统计
2. Excel导出
3. 成员管理
4. 权限细粒度控制

---

## 八、风险与注意事项

### 8.1 技术风险
- **数据迁移**: 原系统数据需要完全清理或迁移
- **云函数兼容性**: 确保uniCloud版本兼容
- **性能**: 项目和任务数量增多时的查询性能

### 8.2 业务风险
- **需求变更**: 与业务团队确认详细需求
- **用户培训**: 系统改造后需要用户培训
- **数据安全**: 部门数据隔离的安全性

### 8.3 建议
1. **分阶段上线**: 先完成P0功能，小范围试用后再迭代
2. **保留备份**: 保留原系统代码的完整备份
3. **文档同步**: 编写API文档和用户手册
4. **反馈机制**: 建立用户反馈通道

---

## 九、预期成果

### 9.1 系统能力
- 支持双部门独立的项目进度管理
- 清晰的项目-任务两级结构
- 实时进度可视化
- 完整的操作历史记录

### 9.2 用户体验
- 简洁直观的界面
- 快速的部门切换
- 一目了然的项目状态
- 便捷的进度更新

### 9.3 数据价值
- 项目进度数据积累
- 团队效率分析
- 项目周期预测
- 资源分配优化

---

## 十、总结

本次改造将原质检系统的核心能力（数据记录、云存储、导出）保留，完全重构业务逻辑，打造一个轻量级、高效的双部门项目进度管理系统。

**总工时估算**: 14-19天
**推荐开发模式**: 敏捷迭代，每阶段交付可用模块
**技术复用率**: 约40%（云存储、图片上传、导出等）

---

*文档版本：V1.0*
*创建时间：2025-11-22*
*作者：Claude AI*
